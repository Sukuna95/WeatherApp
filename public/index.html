<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Forecast App</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../src/styles/App.css">
        
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // API key for OpenWeatherMap (Note: In a real app, this should be secured and not exposed in frontend code)
        // This is a free API key for demonstration purposes - may have limited requests
        const API_KEY = 'API_KEY_HERE;
        const API_URL = 'https://api.openweathermap.org/data/2.5';

        // Weather icons mapping
        const weatherIcons = {
            '01d': 'fas fa-sun',
            '01n': 'fas fa-moon',
            '02d': 'fas fa-cloud-sun',
            '02n': 'fas fa-cloud-moon',
            '03d': 'fas fa-cloud',
            '03n': 'fas fa-cloud',
            '04d': 'fas fa-cloud',
            '04n': 'fas fa-cloud',
            '09d': 'fas fa-cloud-showers-heavy',
            '09n': 'fas fa-cloud-showers-heavy',
            '10d': 'fas fa-cloud-sun-rain',
            '10n': 'fas fa-cloud-moon-rain',
            '11d': 'fas fa-bolt',
            '11n': 'fas fa-bolt',
            '13d': 'fas fa-snowflake',
            '13n': 'fas fa-snowflake',
            '50d': 'fas fa-smog',
            '50n': 'fas fa-smog'
        };

        // ForecastItem Component
        function ForecastItem({ data }) {
            const { dt, main, weather } = data;
            const forecastWeather = weather[0];
            const iconClass = weatherIcons[forecastWeather.icon] || 'fas fa-cloud';
            
            // Format date
            const date = new Date(dt * 1000).toLocaleDateString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric'
            });
            
            return (
                <div className="forecast-item">
                    <p className="forecast-date">{date}</p>
                    <div className="forecast-icon">
                        <i className={iconClass}></i>
                    </div>
                    <p className="forecast-temp">{Math.round(main.temp)}°C</p>
                    <p>{forecastWeather.description}</p>
                </div>
            );
        }

        // Forecast Component
        function Forecast({ data }) {
            // Group forecast by day and get one reading per day
            const dailyForecast = data.list.filter((reading, index) => index % 8 === 0);
            
            return (
                <>
                    <h3 className="forecast-title">5-Day Forecast</h3>
                    <div className="forecast">
                        {dailyForecast.map((day, index) => (
                            <ForecastItem key={index} data={day} />
                        ))}
                    </div>
                </>
            );
        }

        // CurrentWeather Component
        function CurrentWeather({ data }) {
            const { name, main, weather, wind, sys } = data;
            const currentWeather = weather[0];
            const iconClass = weatherIcons[currentWeather.icon] || 'fas fa-cloud';
            
            // Format date
            const date = new Date().toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            return (
                <div className="current-weather">
                    <h2 className="location">
                        {name}, {sys.country}
                    </h2>
                    <p className="date">{date}</p>
                    
                    <div className="weather-icon">
                        <i className={iconClass}></i>
                    </div>
                    
                    <h1 className="temperature">{Math.round(main.temp)}°C</h1>
                    <p className="weather-description">{currentWeather.description}</p>
                    
                    <div className="weather-details">
                        <div className="detail">
                            <i className="fas fa-temperature-high"></i>
                            <p>Feels like</p>
                            <p>{Math.round(main.feels_like)}°C</p>
                        </div>
                        
                        <div className="detail">
                            <i className="fas fa-tint"></i>
                            <p>Humidity</p>
                            <p>{main.humidity}%</p>
                        </div>
                        
                        <div className="detail">
                            <i className="fas fa-wind"></i>
                            <p>Wind Speed</p>
                            <p>{wind.speed} m/s</p>
                        </div>
                    </div>
                </div>
            );
        }

        // Main App Component
        function WeatherApp() {
            const [weatherData, setWeatherData] = React.useState(null);
            const [forecastData, setForecastData] = React.useState(null);
            const [loading, setLoading] = React.useState(true);
            const [error, setError] = React.useState(null);
            const [city, setCity] = React.useState('London');

            // Fetch weather data from API
            const fetchWeatherData = async (cityName) => {
                try {
                    setLoading(true);
                    setError(null);
                    
                    // Fetch current weather
                    const currentResponse = await fetch(
                        `${API_URL}/weather?q=${cityName}&appid=${API_KEY}&units=metric`
                    );
                    
                    if (!currentResponse.ok) {
                        if (currentResponse.status === 404) {
                            throw new Error('City not found. Please try again.');
                        } else if (currentResponse.status === 401) {
                            throw new Error('API key issue. Please try again later.');
                        } else {
                            throw new Error('Failed to fetch weather data. Please try again.');
                        }
                    }
                    
                    const currentData = await currentResponse.json();
                    
                    // Fetch forecast
                    const forecastResponse = await fetch(
                        `${API_URL}/forecast?q=${cityName}&appid=${API_KEY}&units=metric`
                    );
                    
                    if (!forecastResponse.ok) {
                        throw new Error('Failed to fetch forecast data.');
                    }
                    
                    const forecastData = await forecastResponse.json();
                    
                    setWeatherData(currentData);
                    setForecastData(forecastData);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            // Handle search
            const handleSearch = (e) => {
                e.preventDefault();
                const searchValue = e.target.elements.search.value.trim();
                if (searchValue) {
                    setCity(searchValue);
                    fetchWeatherData(searchValue);
                }
            };

            // Initial data fetch
            React.useEffect(() => {
                fetchWeatherData(city);
            }, []);

            return (
                <div className="container">
                    <header className="app-header">
                        <h1>Weather Forecast</h1>
                        <p>Get real-time weather updates</p>
                    </header>
                    
                    <form onSubmit={handleSearch} className="search-container">
                        <input 
                            type="text" 
                            name="search"
                            className="search-input" 
                            placeholder="Enter city name..." 
                            defaultValue={city}
                        />
                        <button type="submit" className="search-button">
                            <i className="fas fa-search"></i> Search
                        </button>
                    </form>
                    
                    <div className="weather-container">
                        {loading && <div className="loading">Loading weather data...</div>}
                        
                        {error && (
                            <div className="error">
                                <i className="fas fa-exclamation-circle"></i>
                                <p>{error}</p>
                            </div>
                        )}
                        
                        {weatherData && !loading && !error && (
                            <>
                                <CurrentWeather data={weatherData} />
                                <Forecast data={forecastData} />
                            </>
                        )}
                    </div>
                </div>
            );
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<WeatherApp />);
    </script>
</body>
</html>
